Функция ПолучитьАдресаРассылки (СсылкаСправочникОбменыДанными, ТолькоОшибки = Ложь) Экспорт


    // Получаем список адресов электронной почты из табличной части справочника
    ЗапросАдреса = Новый Запрос;
    ЗапросАдреса.Текст = 
    "ВЫБРАТЬ
    |	ОбменыДанныхАдресаРассылок.ЭлектронныйАдрес КАК ЭлектронныйАдрес
    |ИЗ
    |	Справочник.ОбменыДанных.АдресаРассылок КАК ОбменыДанныхАдресаРассылок
    |ГДЕ
    |	ОбменыДанныхАдресаРассылок.Ссылка = &Ссылка";

    ЗапросАдреса.УстановитьПараметр("Ссылка", СсылкаСправочникОбменыДанными);
    РезультатЗапроса = ЗапросАдреса.Выполнить();
    ТаблицаАдресов = РезультатЗапроса.Выгрузить();

    // Формируем строку адресов через точку с запятой
    СтрокаАдресов = "";
    Для Каждого СтрокаИзТЧ Из ТаблицаАдресов Цикл
        Если НЕ ПустаяСтрока(СтрокаИзТЧ.ЭлектронныйАдрес) Тогда
            Если СтрокаАдресов = "" Тогда
                СтрокаАдресов = СтрокаИзТЧ.ЭлектронныйАдрес;
            Иначе
                СтрокаАдресов = СтрокаАдресов + "; " + СтрокаИзТЧ.ЭлектронныйАдрес;
            КонецЕсли;
        КонецЕсли;
	КонецЦикла; 
	
    Возврат СтрокаАдресов;
	
КонецФункции